"use strict";!function(n,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():n.typed=t()}(this,function(){function x(){return!0}function cn(){return!1}function pn(){}function mn(n){return Promise.resolve(n)}function j(n){return!!n&&(n.constructor&&n.constructor.prototype&&"function"==typeof n.constructor.prototype.then&&"function"==typeof n.constructor.prototype.catch)}return function n(){var t=[{name:"number",test:function(n){return"number"==typeof n}},{name:"string",test:function(n){return"string"==typeof n}},{name:"boolean",test:function(n){return"boolean"==typeof n}},{name:"Function",test:function(n){return"function"==typeof n}},{name:"Array",test:Array.isArray},{name:"Date",test:function(n){return n instanceof Date}},{name:"RegExp",test:function(n){return n instanceof RegExp}},{name:"Promise",test:j},{name:"Object",test:function(n){return"object"==typeof n&&null!==n&&n.constructor===Object}},{name:"null",test:function(n){return null===n}},{name:"undefined",test:function(n){return void 0===n}}],r={name:"any",test:x},e=[],a=[],G={types:t,conversions:a,ignore:e};function i(t){var n=sn(G.types,function(n){return n.name===t});if(n)return n;if("any"===t)return r;throw n=sn(G.types,function(n){return n.name.toLowerCase()===t.toLowerCase()}),new TypeError('Unknown type "'+t+'"'+(n?'. Did you mean "'+n.name+'"?':""))}function u(n){return n===r?999:G.types.indexOf(n)}function H(t){var n=sn(G.types,function(n){return n.test(t)});if(n)return n.name;throw new TypeError("Value has unknown type. Value: "+t)}function J(n){return n.map(o).join(",")}function o(n){var t=n.types.map(f);return(n.restParam?"...":"")+t.join("|")}function K(n,r){var t,e,a=0===n.indexOf("..."),o=(a?3<n.length?n.slice(3):"any":n).split("|").map(en).filter(g).filter(h),n=(t=o,e={},r.forEach(function(n){-1!==t.indexOf(n.from)||-1===t.indexOf(n.to)||e[n.from]||(e[n.from]=n)}),Object.keys(e).map(function(n){return e[n]})),o=o.map(function(n){var t=i(n);return{name:n,typeIndex:u(t),test:t.test,conversion:null,conversionIndex:-1}}),n=n.map(function(n){var t=i(n.from);return{name:n.from,typeIndex:u(t),test:t.test,conversion:n,conversionIndex:r.indexOf(n)}});return{types:o.concat(n),restParam:a}}function Q(n){return!!(n=y(n))&&n.restParam}function W(n){return n.types.some(function(n){return null!=n.conversion})}function X(n){if(n&&0!==n.types.length){if(1===n.types.length)return i(n.types[0].name).test;if(2===n.types.length){var t=i(n.types[0].name).test,r=i(n.types[1].name).test;return function(n){return t(n)||r(n)}}var e=n.types.map(function(n){return i(n.name).test});return function(n){for(var t=0;t<e.length;t++)if(e[t](n))return!0;return!1}}return x}function Y(n){var r,t,e,a;if(Q(n)){var o=(r=(a=n).slice(0,a.length-1).map(X)).length,u=X(y(n));return function(n){for(var t=0;t<r.length;t++)if(!r[t](n[t]))return!1;return function(n){for(var t=o;t<n.length;t++)if(!u(n[t]))return!1;return!0}(n)&&n.length>=o+1}}return 0===n.length?function(n){return 0===n.length}:1===n.length?(t=X(n[0]),function(n){return t(n[0])&&1===n.length}):2===n.length?(t=X(n[0]),e=X(n[1]),function(n){return t(n[0])&&e(n[1])&&2===n.length}):(r=n.map(X),function(n){for(var t=0;t<r.length;t++)if(!r[t](n[t]))return!1;return n.length===r.length})}function Z(n,t){return t<n.params.length?n.params[t]:Q(n.params)?y(n.params):null}function s(n,t,r){return((t=Z(n,t))?r?t.types.filter(c):t.types:[]).map(f)}function f(n){return n.name}function c(n){return null===n.conversion||void 0===n.conversion}function $(n,t){return-1!==(n=function(n){for(var t={},r=0;r<n.length;r++)t[n[r]]=!0;return Object.keys(t)}(fn(n,function(n){return s(n,t,!1)}))).indexOf("any")?["any"]:n}function p(n){for(var t=999,r=0;r<n.types.length;r++)c(n.types[r])&&(t=Math.min(t,n.types[r].typeIndex));return t}function m(n){for(var t=999,r=0;r<n.types.length;r++)c(n.types[r])||(t=Math.min(t,n.types[r].conversionIndex));return t}function _(n,t){var r,e,a,o,u=Math.min(n.params.length,t.params.length),i=n.params.some(W)-t.params.some(W);if(0!==i)return i;for(r=0;r<u;r++)if(0!=(i=W(n.params[r])-W(t.params[r])))return i;for(r=0;r<u;r++)if(e=n.params[r],a=t.params[r],o=void 0,0!==(i=0!=(o=e.restParam-a.restParam)||0!=(o=W(e)-W(a))||0!=(o=p(e)-p(a))?o:m(e)-m(a)))return i;return n.params.length-t.params.length}function nn(n){var t,r,e,a,o=[],u=[];switch(n.types.forEach(function(n){n.conversion&&(o.push(i(n.conversion.from).test),u.push(n.conversion.convert))}),u.length){case 0:return function(n){return n};case 1:return t=o[0],e=u[0],function(n){return t(n)?e(n):n};case 2:return t=o[0],r=o[1],e=u[0],a=u[1],function(n){return t(n)?e(n):r(n)?a(n):n};default:return function(n){for(var t=0;t<u.length;t++)if(o[t](n))return u[t](n);return n}}}function tn(n,u){return function t(r,e,a){if(e<r.length){var n=r[e],o=u?n.types.filter(c):n.types;return fn(n.restParam?(n=o.filter(c)).length<o.length?[n,o]:[o]:o.map(function(n){return[n]}),function(n){return t(r,e+1,a.concat([n]))})}return[a.map(function(n,t){return{types:n,restParam:t===r.length-1&&Q(r)}})]}(n,0,[])}function rn(n,t){for(var r=Math.max(n.params.length,t.params.length),e=0;e<r;e++)if(!function(n,t){for(var r=0;r<n.length;r++)if(function(n,t){return-1!==n.indexOf(t)}(t,n[r]))return 1}(s(n,e,!0),s(t,e,!0)))return!1;var a=n.params.length,o=t.params.length,u=Q(n.params),i=Q(t.params);return u?i?a===o:a<=o:i?o<=a:a===o}function l(t,e,n){if(0===Object.keys(e).length)throw new SyntaxError("No signatures provided");var r,a=[];Object.keys(e).map(function(n){return r=e[t=n],a=G.conversions,n=[],""!==t.trim()&&(n=t.split(",").map(en).map(function(n,t,r){var e=K(n,a);if(e.restParam&&t!==r.length-1)throw new SyntaxError('Unexpected rest parameter "'+n+'": only allowed for the last parameter');return e})),n.some(on)?null:{params:n,fn:r};var t,r,a}).filter(an).forEach(function(t){var n=sn(a,function(n){return rn(n,t)});if(n)throw new TypeError('Conflicting signatures "'+J(n.params)+'" and "'+J(t.params)+'".');a.push(t)}),n&&!0===n.createAsync&&(l=a,r=G.conversions,h=l.map(function(t){var n=Q(t.params)?function(){var n=un(arguments,0,arguments.length-1);return n.push(Promise.all(arguments[arguments.length-1])),Promise.all(n).then(function(n){return t.fn.apply(t.fn,n)})}:function(){return Promise.all(arguments).then(function(n){return t.fn.apply(t.fn,n)})};return{params:t.params.map(function(n){var t=r.concat(n.types.map(function(n){return{from:n.name,to:"Promise",convert:mn}}));return K(n.restParam?"...Promise":"Promise",t)}),fn:n}}),a=a.concat(h));var o=fn(a,function(t){return(t?tn(t.params,!1):[]).map(function(n){return{params:n,fn:t.fn}})}).filter(an);function u(){for(var n=z;n<B;n++)if(g[n](arguments))return F[n].apply(this,arguments);throw function(n,r,t){for(var e,a=n||"unnamed",o=t,u=0;u<r.length;u++){var i=o.filter(function(n){var t=X(Z(n,u));return(u<n.params.length||Q(n.params))&&t(r[u])});if(0===i.length){if(0<(e=$(o,u)).length){var s,f=H(r[u]);return(s=new TypeError("Unexpected type of argument in function "+a+" (expected: "+e.join(" or ")+", actual: "+f+", index: "+u+")")).data={category:"wrongType",fn:a,index:u,actual:f,expected:e},s}}else o=i}return t=o.map(function(n){return Q(n.params)?1/0:n.params.length}),r.length<Math.min.apply(null,t)?(e=$(o,u),(s=new TypeError("Too few arguments in function "+a+" (expected: "+e.join(" or ")+", index: "+r.length+")")).data={category:"tooFewArgs",fn:a,index:r.length,expected:e}):(t=Math.max.apply(null,t),r.length>t?(s=new TypeError("Too many arguments in function "+a+" (expected: "+t+", actual: "+r.length+")")).data={category:"tooManyArgs",fn:a,index:r.length,expectedLength:t}:(s=new TypeError('Arguments of type "'+r.join(", ")+'" do not match any of the defined signatures of function '+a+".")).data={category:"mismatch",actual:r.map(H)}),s}(t,arguments,o)}function i(n,t){return(arguments.length===L&&y(n)&&O(t)?M:arguments.length===U&&v(n)&&E(t)?k:arguments.length===R&&d(n)&&b(t)?I:arguments.length===V&&w(n)&&P(t)?C:arguments.length===N&&x(n)&&T(t)?S:arguments.length===q&&j(n)&&A(t)?D:u).apply(i,arguments)}o.sort(_);var s,f=o[0]&&o[0].params.length<=2&&!Q(o[0].params),c=o[1]&&o[1].params.length<=2&&!Q(o[1].params),p=o[2]&&o[2].params.length<=2&&!Q(o[2].params),m=o[3]&&o[3].params.length<=2&&!Q(o[3].params),n=o[4]&&o[4].params.length<=2&&!Q(o[4].params),l=o[5]&&o[5].params.length<=2&&!Q(o[5].params),h=f&&c&&p&&m&&n&&l,g=o.map(function(n){return Y(n.params)}),y=f?X(o[0].params[0]):cn,v=c?X(o[1].params[0]):cn,d=p?X(o[2].params[0]):cn,w=m?X(o[3].params[0]):cn,x=n?X(o[4].params[0]):cn,j=l?X(o[5].params[0]):cn,O=f?X(o[0].params[1]):cn,E=c?X(o[1].params[1]):cn,b=p?X(o[2].params[1]):cn,P=m?X(o[3].params[1]):cn,T=n?X(o[4].params[1]):cn,A=l?X(o[5].params[1]):cn,F=o.map(function(n){return function(n,e){var a,o,t=e;n.some(W)&&(a=Q(n),o=n.map(nn),t=function(){for(var n=[],t=a?arguments.length-1:arguments.length,r=0;r<t;r++)n[r]=o[r](arguments[r]);return a&&(n[t]=arguments[t].map(o[t])),e.apply(this,n)});var r,u=t;return Q(n)&&(r=n.length-1,u=function(){return t.apply(this,un(arguments,0,r).concat([un(arguments,r)]))}),u}(n.params,n.fn)}),M=f?F[0]:pn,k=c?F[1]:pn,I=p?F[2]:pn,C=m?F[3]:pn,S=n?F[4]:pn,D=l?F[5]:pn,L=f?o[0].params.length:-1,U=c?o[1].params.length:-1,R=p?o[2].params.length:-1,V=m?o[3].params.length:-1,N=n?o[4].params.length:-1,q=l?o[5].params.length:-1,z=h?6:0,B=o.length;try{Object.defineProperty(i,"name",{value:t})}catch(n){}return i.signatures=(s={},o.forEach(function(t){t.params.some(W)||tn(t.params,!0).forEach(function(n){s[J(n)]=t.fn})}),s),i}function h(n){return-1===G.ignore.indexOf(n)}function en(n){return n.trim()}function g(n){return!!n}function an(n){return null!==n}function on(n){return 0===n.types.length}function y(n){return n[n.length-1]}function un(n,t,r){return Array.prototype.slice.call(n,t,r)}function sn(n,t){for(var r=0;r<n.length;r++)if(t(n[r]))return n[r]}function fn(n,t){return Array.prototype.concat.apply([],n.map(t))}function v(n){for(var t="",r=0;r<n.length;r++){var e=n[r];if(("object"==typeof e.signatures||"string"==typeof e.signature)&&""!==e.name)if(""===t)t=e.name;else if(t!==e.name){var a=new Error("Function names do not match (expected: "+t+", actual: "+e.name+")");throw a.data={actual:e.name,expected:t},a}}return t}function d(n){var t,r=[];for(t in n)n.hasOwnProperty(t)&&r.push(n[t]);return v(r)}function w(n){var r,e={};function t(n,t){if(e.hasOwnProperty(n)&&t!==e[n])throw(r=new Error('Signature "'+n+'" is defined twice')).data={signature:n},r}for(var a=0;a<n.length;a++){var o=n[a];if("object"==typeof o.signatures)for(var u in o.signatures)o.signatures.hasOwnProperty(u)&&(t(u,o.signatures[u]),e[u]=o.signatures[u]);else{if("string"!=typeof o.signature)throw(r=new TypeError("Function is no typed-function (index: "+a+")")).data={index:a},r;t(o.signature,o),e[o.signature]=o}}return e}return(G=l("typed",{"string, Object":l,"string, Object, Object":l,Object:function(n){return l(d(n),n)},"Object, Object":function(n,t){return l(d(n),n,t)},"...Function":function(n){return l(v(n),w(n))},"string, ...Function":function(n,t){return l(n,w(t))}})).create=n,G.types=t,G.conversions=a,G.ignore=e,G.convert=function(n,t){var r=H(n);if(t===r)return n;for(var e=0;e<G.conversions.length;e++){var a=G.conversions[e];if(a.from===r&&a.to===t)return a.convert(n)}throw new Error("Cannot convert from "+r+" to "+t)},G.find=function(n,t){if(!n.signatures)throw new TypeError("Function is no typed-function");var r;if("string"==typeof t){r=t.split(",");for(var e=0;e<r.length;e++)r[e]=r[e].trim()}else{if(!Array.isArray(t))throw new TypeError("String array or a comma separated string expected");r=t}if(t=r.join(","),t=n.signatures[t])return t;throw new TypeError("Signature not found (signature: "+(n.name||"unnamed")+"("+r.join(", ")+"))")},G.addType=function(n,t){if(!n||"string"!=typeof n.name||"function"!=typeof n.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==t)for(var r=0;r<G.types.length;r++)if("Object"===G.types[r].name)return void G.types.splice(r,0,n);G.types.push(n)},G.addConversion=function(n){if(!n||"string"!=typeof n.from||"string"!=typeof n.to||"function"!=typeof n.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");G.conversions.push(n)},G}()});